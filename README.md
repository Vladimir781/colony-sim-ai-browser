# Браузерная колония с ИИ

Локальная 2D-симуляция колонии, запускаемая прямо из файловой системы. Каждый агент управляется собственным мозгом на основе небольшой нейросети и может обучаться методом REINFORCE во время работы симуляции.

## Быстрый старт

1. Скачайте каталог проекта целиком.
2. Откройте файл `index.html` двойным кликом в актуальной версии Chrome, Firefox или Safari.
3. После загрузки нажмите кнопку ⚙️, чтобы раскрыть панель, и на вкладке «Обзор» нажмите «Старт».

Приложение не требует запуска локального сервера и работает без сетевого доступа.

## Основные возможности

- Сеточная карта 64×64 тайла с биомами и ресурсами.
- Персональный мозг у каждого агента (Tiny-MLP по умолчанию, Tiny-GRU опционально).
- Онлайн-обучение REINFORCE с контролем частоты и клиппингом градиента.
- Панель управления с вкладками для обзора, агентов, мира, коммуникаций, событий, хранения данных, настроек и интерактивной справки.
- Сохранение состояния и мозгов агентов в IndexedDB с фолбэком в память.
- Фолбэк для рендера на Canvas 2D; WebGL не требуется.
- Рабочий фолбэк воркера: при невозможности создать модульный WebWorker симуляция выполняется в основном потоке.

## Структура проекта

```
index.html
importmap.generated.json
/game
  main.js
  types.js
  /ai
  /assets
  /core
  /data
  /panel
  /render
  /storage
  /styles
  /worker
```

Исходники лежат в `game/` и подключаются через import map: все JS-файлы автоматически превращаются в data URI, так что Chrome/Firefox/Safari могут загружать их даже по `file://`.

## Работа с ассетами

Все графические ассеты и шрифты подключаются в виде текстовых ES-модулей с data URI, чтобы проект без проблем открывался через `file://` и чтобы их можно было просматривать в диффах.

Для конвертации новых файлов используйте утилиту `tools/asset2b64.js`:

```
node tools/asset2b64.js <входной-файл> <выходной-модуль> [ИМЯ_КОНСТАНТЫ]
```

- MIME-тип определяется автоматически по расширению.
- По умолчанию имя константы формируется из имени файла (например, `spritesheet.png` → `SPRITESHEET_B64`).
- Если аргумент `<выходной-модуль>` не указан, модуль печатается в stdout.

Пример: `node tools/asset2b64.js game/assets/new.png game/assets/new.b64.js NEW_SPRITE_B64`

## Обновление import map

После изменения любого JS-модуля запустите генератор import map, чтобы обновить `importmap.generated.json`:

```
node tools/build_importmap.js
```

Он рекурсивно обходит `game/`, переписывает относительные импорты в псевдонимы `app/...` и сохраняет data URI. Файл коммитим в репозиторий, чтобы запуск по `file://` не требовал дополнительной сборки.

## Тестирование

Автоматические тесты не входят в поставку. Для проверки корректности рекомендуется:

- Запустить симуляцию на 10–15 минут и убедиться, что FPS и состояние агентов стабильны.
- Проверить сохранение/загрузку, экспорт/импорт мозгов и переключение режимов обучения.

## Лицензия

Проект распространяется под лицензией MIT.
